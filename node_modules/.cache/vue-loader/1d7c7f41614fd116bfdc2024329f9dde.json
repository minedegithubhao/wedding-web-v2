{"remainingRequest":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/src/components/pts/WebShell/terminal.vue?vue&type=style&index=0&lang=less&","dependencies":[{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/src/components/pts/WebShell/terminal.vue","mtime":1605568762427},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/less-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKI3Rlcm1pbmFsIHsKICB0cmFuc2l0aW9uOiBhbGwgMC40cyBlYXNlIDBzOwogIHBvc2l0aW9uOiByZWxhdGl2ZTsKICBvdmVyZmxvdzogaGlkZGVuOwogIHBhZGRpbmc6IDhweCAwOwp9CiN0ZXJtaW5hbCAueHRlcm0tdmlld3BvcnQ6Oi13ZWJraXQtc2Nyb2xsYmFyIHsKICB3aWR0aDogNHB4OwogIGhlaWdodDogNHB4Owp9CgojdGVybWluYWwgLnh0ZXJtLXZpZXdwb3J0Ojotd2Via2l0LXNjcm9sbGJhci10aHVtYiB7CiAgYm9yZGVyLXJhZGl1czogNHB4OwogIGJhY2tncm91bmQ6ICNlMGUzZTc7CiAgaGVpZ2h0OiAyMHB4Owp9CiN0ZXJtaW5hbCAueHRlcm0tdmlld3BvcnQ6Oi13ZWJraXQtc2Nyb2xsYmFyLWNvcm5lciB7CiAgYmFja2dyb3VuZDogI2ZmZjsKfQojdGVybWluYWwgLnh0ZXJtLXZpZXdwb3J0Ojotd2Via2l0LXNjcm9sbGJhci10cmFjayB7CiAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7Cn0KCiN0ZXJtaW5hbCAueHRlcm0tdmlld3BvcnQ6Oi1vLXNjcm9sbGJhciB7CiAgd2lkdGg6IDRweDsKICBoZWlnaHQ6IDRweDsKfQojdGVybWluYWwgLnh0ZXJtLXZpZXdwb3J0Ojotby1zY3JvbGxiYXItdGh1bWIgewogIGJvcmRlci1yYWRpdXM6IDRweDsKICBiYWNrZ3JvdW5kOiAjZTBlM2U3OwogIGhlaWdodDogMjBweDsKfQojdGVybWluYWwgLnh0ZXJtLXZpZXdwb3J0Ojotby1zY3JvbGxiYXItY29ybmVyIHsKICBiYWNrZ3JvdW5kOiAjZmZmOwp9CiN0ZXJtaW5hbCAueHRlcm0tdmlld3BvcnQ6Oi1vLXNjcm9sbGJhci10cmFjayB7CiAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7Cn0KCiN0ZXJtaW5hbCAueHRlcm0tdmlld3BvcnQ6Oi1tb3otc2Nyb2xsYmFyIHsKICB3aWR0aDogNHB4OwogIGhlaWdodDogNHB4Owp9CiN0ZXJtaW5hbCAueHRlcm0tdmlld3BvcnQ6Oi1tb3otc2Nyb2xsYmFyLXRodW1iIHsKICBib3JkZXItcmFkaXVzOiA0cHg7CiAgYmFja2dyb3VuZDogI2UwZTNlNzsKICBoZWlnaHQ6IDIwcHg7Cn0KI3Rlcm1pbmFsIC54dGVybS12aWV3cG9ydDo6LW1vei1zY3JvbGxiYXItY29ybmVyIHsKICBiYWNrZ3JvdW5kOiAjZmZmOwp9CiN0ZXJtaW5hbCAueHRlcm0tdmlld3BvcnQ6Oi1tb3otc2Nyb2xsYmFyLXRyYWNrIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsKfQoKI3Rlcm1pbmFsIC54dGVybS12aWV3cG9ydCB7CiAgLW1zLXNjcm9sbC1jaGFpbmluZzogY2hhaW5lZDsKICAtbXMtb3ZlcmZsb3ctc3R5bGU6IG5vbmU7CiAgLW1zLWNvbnRlbnQtem9vbWluZzogem9vbTsKICAtbXMtc2Nyb2xsLXJhaWxzOiBub25lOwogIC1tcy1jb250ZW50LXpvb20tbGltaXQtbWluOiAxMDAlOwogIC1tcy1jb250ZW50LXpvb20tbGltaXQtbWF4OiA1MDAlOwogIC1tcy1zY3JvbGwtc25hcC10eXBlOiBwcm94aW1pdHk7CiAgLW1zLXNjcm9sbC1zbmFwLXBvaW50cy14OiBzbmFwTGlzdCgxMDAlLCAyMDAlLCAzMDAlLCA0MDAlLCA1MDAlKTsKICAtbXMtb3ZlcmZsb3ctc3R5bGU6IG5vbmU7CiAgb3ZlcmZsb3c6IGF1dG87Cn0KLnh0ZXJtIHsKICAueHRlcm0tc2NyZWVuIHsKICAgIHdpZHRoOiAxMDAlICFpbXBvcnRhbnQ7CiAgICBwYWRkaW5nOiAwIDhweDsKICAgIC54dGVybS1yb3dzIHsKICAgICAgZGl2IHsKICAgICAgICB3aWR0aDogMTAwJSAhaW1wb3J0YW50OwogICAgICB9CiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["terminal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"terminal.vue","sourceRoot":"src/components/pts/WebShell","sourcesContent":["<template>\n  <div id=\"terminal\" ref=\"terminal\" :style=\"{ marginLeft: showDrawer ? drawerWidth : '0px' }\"></div>\n</template>\n\n<script>\n/* eslint-disable */\nimport { Terminal } from 'xterm'\nimport { FitAddon } from 'xterm-addon-fit'\nimport 'xterm/css/xterm.css'\nimport 'xterm/lib/xterm.js'\nimport { createUuid } from '@/utils/util'\nimport client from './webssh.js'\n\n/* eslint-disable */\nexport default {\n  name: 'WebShellTerminal',\n  components: {},\n  props: {\n    showDrawer: {\n      type: Boolean,\n      default: false\n    },\n    drawerWidth: {\n      type: String,\n      default: '165px'\n    },\n    termData: {\n      type: Object,\n      default: () => {}\n    },\n    termName: {\n      type: String,\n      default: 'WebShell'\n    }\n  },\n  data() {\n    return {\n      term: '',\n      uuid: ''\n    }\n  },\n  computed: {},\n  watch: {\n    // termData: {\n    //   handler: function(val, oldVal) {\n    //     this.handleConnect(val)\n    //   },\n    //   deep: true\n    // }\n  },\n  created() {},\n  mounted() {\n    this.uuid = createUuid()\n    this.initTerm(this.uuid)\n  },\n  beforeDestroy() {\n    client.close(this.uuid)\n  },\n  methods: {\n    initTerm(uuid) {\n      const _this = this\n      // 获取容器宽高/字号大小，定义行数和列数\n      // const terminalContainer = document.getElementById('terminal')\n      const terminalContainer = this.$refs.terminal\n      // const rows = (terminalContainer.offsetHeight) / 16;\n      // this.cols = terminalContainer.offsetWidth / 14;\n      // 创建xterm实例\n      let term = new Terminal({\n        rendererType: 'dom',\n        // cols: 120,\n        // rows: parseInt(rows),\n        convertEol: true, // 启用时，光标将设置为下一行的开头\n        // scrollback: 50, // 终端中的回滚量\n        disableStdin: false, // 是否应禁用输入。\n        cursorStyle: 'underline', // 光标样式  null | 'block' | 'underline' | 'bar'\n        cursorBlink: true, // 光标闪烁\n        tabStopWidth: 8, // 制表宽度\n        theme: {\n          // foreground: '#7e9192', // 字体\n          background: '#2b2b2b', // 背景色\n          cursor: 'help', // 设置光标\n          lineHeight: 30,\n          foreground: '#dbdbdb'\n        }\n      }) // 创建一个新的Terminal对象\n      term.open(terminalContainer) // 将term挂载到dom节点上\n      // 换行并输入起始符“$”\n      term.prompt = () => {\n        // term.write('\\r\\n$ ')\n        term.write('$ ')\n      }\n      term.prompt()\n      // canvas背景全屏\n      const fitAddon = new FitAddon()\n      term.loadAddon(fitAddon)\n      // fitAddon.fit()\n      // window.addEventListener('resize', resizeScreen)\n      // // 内容全屏显示\n      // function resizeScreen() {\n      //   // 不传size\n      //   try {\n      //     // fitAddon.fit()\n      //     // 窗口大小改变时触发xterm的resize方法，向后端发送行列数，格式由后端决定\n      //     // 这里不使用size默认参数，因为改变窗口大小只会改变size中的列数而不能改变行数，所以这里不使用size.clos,而直接使用获取我们根据窗口大小计算出来的行列数\n      //     // term.onResize(() => {\n      //     //   client.sendClientData({ Op: 'resize', Cols: term.cols, Rows: term.rows })\n      //     // })\n      //   } catch (e) {\n      //     console.log('e', e.message)\n      //   }\n      // }\n\n      function runFakeTerminal(_this) {\n        if (term._initialized) {\n          return\n        }\n        // 初始化\n        term._initialized = true\n\n        term.writeln(`Welcome to use \\x1B[1;3;31m${_this.termName} \\x1B[0m. `)\n\n        term.prompt()\n        //执行连接操作\n        client.connect({\n          onError: function(error) {\n            //连接失败回调\n            term.write('Error: ' + error + '\\r\\n')\n          },\n          onConnect: function() {\n            //连接成功回调\n            _this.handleConnect(_this.termData)\n          },\n          onClose: function() {\n            //连接关闭回调\n            term.write('\\r\\n')\n            term.write('connection closed')\n            term.write('\\r\\n')\n          },\n          onData: function(data) {\n            //收到数据时回调\n            term.write(data)\n            if (data === 'exit') {\n              term.write('\\r\\n')\n            }\n          }\n        }, uuid)\n        // / **\n        //     *添加事件监听器，用于按下键时的事件。事件值包含\n        //     *将在data事件以及DOM事件中发送的字符串\n        //     *触发了它。\n        //     * @返回一个IDisposable停止监听。\n        //  * /\n        //   / ** 更新：xterm 4.x（新增）\n        //  *为数据事件触发时添加事件侦听器。发生这种情况\n        //  *用户输入或粘贴到终端时的示例。事件值\n        //  *是`string`结果的结果，在典型的设置中，应该通过\n        //  *到支持pty。\n        //  * @返回一个IDisposable停止监听。\n        //  * /\n        // 支持输入与粘贴方法\n        term.onData(function(data) {\n          client.sendClientData(data, uuid)\n        })\n\n        _this.term = term\n      }\n      runFakeTerminal(_this)\n    },\n    handleConnect(values) {\n      if (values && values.ip && values.port && values.username && values.password) {\n        const params = {\n          host: values.ip,\n          port: values.port,\n          username: values.username,\n          password: values.password,\n          operate: 'connect'\n        }\n        //在页面上显示连接中...\n        this.term.writeln(`Connecting to ${values.ip}:${values.port}...\\r\\n`)\n        client.sendInitData(params, this.uuid)\n      }\n    },\n    handleSend(data) {\n      client.sendClientData(data, this.uuid)\n    },\n    handleClose() {\n      // client.close()\n      this.term.write('\\r\\n')\n      this.term.writeln(`exiting...`)\n      client.sendClientData('exit', this.uuid)\n    }\n  }\n}\n</script>\n<style lang=\"less\">\n#terminal {\n  transition: all 0.4s ease 0s;\n  position: relative;\n  overflow: hidden;\n  padding: 8px 0;\n}\n#terminal .xterm-viewport::-webkit-scrollbar {\n  width: 4px;\n  height: 4px;\n}\n\n#terminal .xterm-viewport::-webkit-scrollbar-thumb {\n  border-radius: 4px;\n  background: #e0e3e7;\n  height: 20px;\n}\n#terminal .xterm-viewport::-webkit-scrollbar-corner {\n  background: #fff;\n}\n#terminal .xterm-viewport::-webkit-scrollbar-track {\n  background-color: transparent;\n}\n\n#terminal .xterm-viewport::-o-scrollbar {\n  width: 4px;\n  height: 4px;\n}\n#terminal .xterm-viewport::-o-scrollbar-thumb {\n  border-radius: 4px;\n  background: #e0e3e7;\n  height: 20px;\n}\n#terminal .xterm-viewport::-o-scrollbar-corner {\n  background: #fff;\n}\n#terminal .xterm-viewport::-o-scrollbar-track {\n  background-color: transparent;\n}\n\n#terminal .xterm-viewport::-moz-scrollbar {\n  width: 4px;\n  height: 4px;\n}\n#terminal .xterm-viewport::-moz-scrollbar-thumb {\n  border-radius: 4px;\n  background: #e0e3e7;\n  height: 20px;\n}\n#terminal .xterm-viewport::-moz-scrollbar-corner {\n  background: #fff;\n}\n#terminal .xterm-viewport::-moz-scrollbar-track {\n  background-color: transparent;\n}\n\n#terminal .xterm-viewport {\n  -ms-scroll-chaining: chained;\n  -ms-overflow-style: none;\n  -ms-content-zooming: zoom;\n  -ms-scroll-rails: none;\n  -ms-content-zoom-limit-min: 100%;\n  -ms-content-zoom-limit-max: 500%;\n  -ms-scroll-snap-type: proximity;\n  -ms-scroll-snap-points-x: snapList(100%, 200%, 300%, 400%, 500%);\n  -ms-overflow-style: none;\n  overflow: auto;\n}\n.xterm {\n  .xterm-screen {\n    width: 100% !important;\n    padding: 0 8px;\n    .xterm-rows {\n      div {\n        width: 100% !important;\n      }\n    }\n  }\n}\n</style>\n"]}]}