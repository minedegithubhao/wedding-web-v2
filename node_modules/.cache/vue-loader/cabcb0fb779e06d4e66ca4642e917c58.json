{"remainingRequest":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/src/views/account/settings/Security.vue?vue&type=style&index=0&id=4b2f4ac0&lang=less&scoped=true&","dependencies":[{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/src/views/account/settings/Security.vue","mtime":1605568762448},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/less-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoucGFzc3dvcmQtc3RyZW5ndGggewogIG1hcmdpbi10b3A6IDhweDsKICAuc3RyZW5ndGgtbGFiZWwgewogICAgbWFyZ2luLXJpZ2h0OiA4cHg7CiAgfQogIC5zdHJlbmd0aC1ib3ggewogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgZm9udC1zaXplOiAxMnB4OwogICAgbWFyZ2luOiAwIDNweDsKICAgIHdpZHRoOiA3MHB4OwogICAgaGVpZ2h0OiAxNnB4OwogICAgbGluZS1oZWlnaHQ6IDE2cHg7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZGVkY2RjOwogICAgY29sb3I6ICNmZmY7CiAgfQogIC5wYXNzd29yZC13ZWFrIHsKICAgIGJhY2tncm91bmQ6ICNjZTRkMWI7CiAgfQogIC5wYXNzd29yZC1taWRkbGUgewogICAgYmFja2dyb3VuZDogI2VmYzIxZjsKICB9CiAgLnBhc3N3b3JkLXN0cm9uZyB7CiAgICBiYWNrZ3JvdW5kOiAjMWZiZmVmOwogIH0KICAucGFzc3dvcmQtbm9ybWFsIHsKICAgIGJhY2tncm91bmQ6ICNkZWRjZGM7CiAgfQp9CgouYS1hY3Rpb25zIHsKICB1c2VyLXNlbGVjdDogbm9uZTsKfQoucGFzc3dvcmQtYnV0dG9uIHsKICBtYXJnaW46IDAgYXV0bzsKfQo="},{"version":3,"sources":["Security.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6NA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"Security.vue","sourceRoot":"src/views/account/settings","sourcesContent":["<template>\n  <div>\n    <a-list itemLayout=\"horizontal\" :dataSource=\"data\">\n      <a-list-item slot=\"renderItem\" slot-scope=\"item, index\" :key=\"index\">\n        <a-list-item-meta>\n          <a slot=\"title\" @click=\"passwordClick\">{{ item.title }}</a>\n          <span slot=\"description\">\n            <span class=\"security-list-description\">{{ item.description }}</span>\n            <span v-if=\"item.value\">:</span>\n            <span class=\"security-list-value\">{{ item.value }}</span>\n          </span>\n        </a-list-item-meta>\n        <template v-if=\"item.actions\">\n          <a\n            slot=\"actions\"\n            class=\"a-actions\"\n            @click=\"item.actions.callback\"\n          >{{ passwordUpdate?'取消':item.actions.title }}</a>\n        </template>\n      </a-list-item>\n    </a-list>\n    <a-row v-if=\"passwordUpdate\" :style=\"{borderTop: '1px solid #ecebeb', paddingTop:'10px'}\">\n      <a-col :md=\"16\" :lg=\"16\">\n        <a-form :form=\"form\" layout=\"vertical\" @submit=\"handleSubmit\">\n          <a-form-item style=\"display:none\">\n            <a-input v-decorator=\"['userId']\" />\n          </a-form-item>\n          <a-form-item label=\"用户名\">\n            <a-input\n              placeholder=\"用户名\"\n              disabled\n              v-decorator=\"['userName', {rules: formValidatorRules.userName}]\"\n            />\n          </a-form-item>\n          <a-form-item label=\"旧密码\">\n            <a-input\n              placeholder=\"旧密码\"\n              type=\"password\"\n              autocomplete=\"false\"\n              v-decorator=\"['oldPassword', {rules: formValidatorRules.oldPassword}]\"\n            />\n          </a-form-item>\n          <a-form-item label=\"新密码\">\n            <a-input\n              placeholder=\"新密码\"\n              type=\"password\"\n              autocomplete=\"false\"\n              v-decorator=\"['password', {rules: formValidatorRules.password}]\"\n            />\n            <div v-if=\"passwordStatus\" class=\"password-strength\">\n              <span class=\"strength-label\">密码强度:</span>\n              <span class=\"strength-box\" :class=\"strengthOne\">弱</span>\n              <span class=\"strength-box\" :class=\"strengthTwo\">中</span>\n              <span class=\"strength-box\" :class=\"strengthThree\">强</span>\n            </div>\n          </a-form-item>\n          <a-form-item label=\"确认密码\">\n            <a-input\n              placeholder=\"确认密码\"\n              type=\"password\"\n              autocomplete=\"false\"\n              v-decorator=\"['password2', {rules: formValidatorRules.password2}]\"\n            />\n          </a-form-item>\n          <a-form-item>\n            <a-button\n              type=\"primary\"\n              :loading=\"passwordLoading\"\n              htmlType=\"submit\"\n              class=\"password-button\"\n            >确定</a-button>\n          </a-form-item>\n        </a-form>\n      </a-col>\n    </a-row>\n  </div>\n</template>\n\n<script>\nimport { updatePwd } from '@/api/system'\nimport pick from 'lodash.pick'\n\nexport default {\n  data() {\n    return {\n      passwordUpdate: false,\n      passwordLoading: false,\n      passwordStatus: false,\n      strengthOne: 'password-weak',\n      strengthTwo: 'password-normal',\n      strengthThree: 'password-normal',\n      form: this.$form.createForm(this),\n      labelCol: {\n        xs: { span: 24 },\n        sm: { span: 5 }\n      },\n      wrapperCol: {\n        xs: { span: 24 },\n        sm: { span: 16 }\n      },\n      formValidatorRules: {\n        userName: [{ required: true, message: '请输入用户名' }],\n        oldPassword: [{ required: true, min: 6, max: 16, message: '请输入6到16位密码,区分大小写' }],\n        password: [\n          { required: true, min: 6, max: 16, message: '请输入6到16位密码,区分大小写' },\n          { validator: this.validatorPwdStrength }\n        ],\n        password2: [\n          { required: true, min: 6, max: 16, message: '请输入6到16位密码,区分大小写' },\n          { validator: this.validatorPassword2 }\n        ]\n      },\n      data: [\n        {\n          title: '账户密码',\n          description: '用户密码设置',\n          value: '',\n          actions: {\n            title: '修改',\n            callback: () => {\n              this.passwordUpdate = !this.passwordUpdate\n              this.$nextTick(() => {\n                this.form.setFieldsValue(pick(this.userInfo, 'userId', 'userName'))\n              })\n            }\n          }\n        }\n        // { title: '密保手机', description: '已绑定手机', value: '138****8293', actions: { title: '修改', callback: () => { this.$message.success('This is a message of success') } } },\n        // { title: '密保问题', description: '未设置密保问题，密保问题可有效保护账户安全', value: '', actions: { title: '设置', callback: () => { this.$message.error('This is a message of error') } } },\n        // { title: '备用邮箱', description: '已绑定邮箱', value: 'ant***sign.com', actions: { title: '修改', callback: () => { this.$message.warning('This is message of warning') } } }\n        // { title: 'MFA 设备', description: '未绑定 MFA 设备，绑定后，可以进行二次确认', value: '', actions: { title: '绑定', callback: () => { this.$message.info('This is a normal message') } } }\n      ]\n    }\n  },\n  created() {},\n  computed: {\n    userInfo() {\n      return this.$store.getters.userInfo\n    }\n  },\n  methods: {\n    validatorPwdStrength(rule, value, callback) {\n      // 密码长度大于等于8位数 包含大写字母[A-Z] + 小写字母[a-z] + 数字[0-9] + 非单词字符的特殊字符[标点符号，空格等]\n      const strongRegex = new RegExp('^(?=.{8,})(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])(?=.*\\\\W).*$', 'g') // 强\n      // 密码长度大于等于7位数 大写字母[A-Z] + 小写字母[a-z] 或者 大写字母[A-Z] + 数字[0-9] 或者 小写字母[a-z] + 数字[0-9] + 任意字符 结尾\n      const mediumRegex = new RegExp('^(?=.{7,})(((?=.*[A-Z])(?=.*[a-z]))|((?=.*[A-Z])(?=.*[0-9]))|((?=.*[a-z])(?=.*[0-9]))).*$', 'g') // 中\n      // 大于等于6位 任何字符或者数字 (如果达不到这个条件就是弱)\n      const enoughRegex = new RegExp('(?=.{6,}).*', 'g') // 弱\n      if (strongRegex.test(value)) {\n        this.strengthOne = 'password-strong'\n        this.strengthTwo = 'password-strong'\n        this.strengthThree = 'password-strong'\n      } else if (mediumRegex.test(value)) {\n        this.strengthOne = 'password-middle'\n        this.strengthTwo = 'password-middle'\n        this.strengthThree = 'password-normal'\n      } else {\n        this.strengthOne = 'password-weak'\n        this.strengthTwo = 'password-normal'\n        this.strengthThree = 'password-normal'\n      }\n      if (value.length >= 6 && value.length <= 16) {\n        this.passwordStatus = true\n      } else {\n        this.passwordStatus = false\n      }\n      callback()\n    },\n    validatorPassword2(rule, value, callback) {\n      const password = this.form.getFieldValue('password')\n      if (value && password && value.length >= 6 && value.length <= 16 && value.trim() !== password.trim()) {\n        callback(new Error('两次密码不一致'))\n      }\n      callback()\n    },\n    passwordClick() {\n      this.passwordUpdate = !this.passwordUpdate\n      this.$nextTick(() => {\n        this.form.setFieldsValue(pick(this.userInfo, 'userId', 'userName'))\n      })\n    },\n    handleSubmit(e) {\n      e.preventDefault()\n      const {\n        form: { validateFields }\n      } = this\n      validateFields((err, values) => {\n        if (!err) {\n          const self = this\n          this.$confirm({\n            title: '确定要修改密码?',\n            onOk() {\n              self.passwordLoading = true\n              updatePwd(values)\n                .then(res => {\n                  if (res.code === 0) {\n                    self.$message.success(`${values.userName} ` + '修改密码成功')\n                    // this.$emit('ok')\n                    self.visible = false\n                    self.passwordUpdate = false\n                  } else {\n                    self.$message.error(res.msg)\n                  }\n                })\n                .catch(() => {\n                  self.$message.error('系统错误，请稍后再试')\n                })\n                .finally(() => {\n                  self.passwordLoading = false\n                })\n            },\n            onCancel() {}\n          })\n        }\n      })\n    }\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n.password-strength {\n  margin-top: 8px;\n  .strength-label {\n    margin-right: 8px;\n  }\n  .strength-box {\n    display: inline-block;\n    text-align: center;\n    font-size: 12px;\n    margin: 0 3px;\n    width: 70px;\n    height: 16px;\n    line-height: 16px;\n    background-color: #dedcdc;\n    color: #fff;\n  }\n  .password-weak {\n    background: #ce4d1b;\n  }\n  .password-middle {\n    background: #efc21f;\n  }\n  .password-strong {\n    background: #1fbfef;\n  }\n  .password-normal {\n    background: #dedcdc;\n  }\n}\n\n.a-actions {\n  user-select: none;\n}\n.password-button {\n  margin: 0 auto;\n}\n</style>\n"]}]}