{"remainingRequest":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/src/views/system/modules/PermissionModal.vue?vue&type=style&index=0&lang=less&","dependencies":[{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/src/views/system/modules/PermissionModal.vue","mtime":1605568762477},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/less-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5kZXRhaWwtbGlzdC1pbmZvIHsKICAudGVybSB7CiAgICBjb2xvcjogI2QyMDAwMDk5ICFpbXBvcnRhbnQ7CiAgICBwYWRkaW5nLWJvdHRvbTogNnB4ICFpbXBvcnRhbnQ7CiAgfQogIC5jb250ZW50IHsKICAgIGNvbG9yOiAjYTVhNGE0ICFpbXBvcnRhbnQ7CiAgICBwYWRkaW5nLWJvdHRvbTogNnB4ICFpbXBvcnRhbnQ7CiAgfQp9Cg=="},{"version":3,"sources":["PermissionModal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"PermissionModal.vue","sourceRoot":"src/views/system/modules","sourcesContent":["<template>\n  <a-modal title=\"操作\" style=\"top: 20px;\" :width=\"1000\" v-model=\"visible\" @ok=\"handleSubmit\">\n    <a-form :form=\"form\">\n      <a-row :gutter=\"64\">\n        <a-col :span=\"12\" style=\"border-right: 1px solid #eaeaea\">\n          <div class=\"modal-divider-text\">基本配置</div>\n          <a-form-item style=\"display:none\">\n            <a-input v-decorator=\"['menuId']\" />\n          </a-form-item>\n          <a-form-item :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" label=\"上级权限\">\n            <a-tree-select\n              v-decorator=\"['parentId', {rules: [{ required: true, message: '请选择上级权限' }]}]\"\n              :dropdownStyle=\"{ maxHeight: '400px', overflow: 'auto' }\"\n              :treeData=\"permissions\"\n              placeholder=\"上级权限\"\n              treeDefaultExpandAll\n            ></a-tree-select>\n          </a-form-item>\n\n          <a-form-item :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" label=\"权限类型\">\n            <a-select\n              v-decorator=\"['menuType', {initialValue:'M',rules: [{ required: true, message: '请选择类型' }]}]\"\n              @select=\"menuTypeChange\"\n            >\n              <a-select-option :value=\"'M'\">目录</a-select-option>\n              <a-select-option :value=\"'C'\">菜单</a-select-option>\n              <a-select-option :value=\"'F'\">按钮</a-select-option>\n            </a-select>\n          </a-form-item>\n\n          <a-form-item :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" label=\"权限名称\">\n            <a-input\n              v-decorator=\"['menuName',{rules: [{ required: true, message: '请输入权限名称' }]}]\"\n              placeholder=\"起一个名字\"\n            />\n          </a-form-item>\n\n          <a-form-item :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" label=\"唯一标识\">\n            <a-input v-decorator=\"['menuKey']\" placeholder=\"唯一标识：如'user'\" />\n          </a-form-item>\n\n          <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            v-if=\"menuType!='M'\"\n            label=\"权限标识\"\n          >\n            <a-input\n              v-decorator=\"['perms',{rules: [{ required: false, message: '请输入权限标识' }]}]\"\n              placeholder=\"权限标识\"\n            />\n          </a-form-item>\n\n          <a-form-item :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" v-if=\"menuType!=='F'\">\n            <span slot=\"label\">组件</span>\n            <a-input\n              v-decorator=\"['component',{rules: [{ required: false, message: '请输入组件' }]}]\"\n              placeholder=\"组件\"\n            />\n          </a-form-item>\n\n          <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            v-if=\"menuType!=='F'\"\n            label=\"图标\"\n          >\n            <a-input\n              v-decorator=\"['icon',{rules: [{ required: false, message: '请选择图标' }]}]\"\n              ref=\"iconInput\"\n              @click=\"iconselect()\"\n              enterButton=\"选择图标\"\n              placeholder=\"选择图标\"\n            >\n              <a-icon slot=\"prefix\" :type=\"icon\" />\n              <a-icon slot=\"suffix\" type=\"close-circle\" @click=\"emitEmpty\" />\n            </a-input>\n          </a-form-item>\n        </a-col>\n        <a-col :span=\"12\">\n          <div class=\"modal-divider-text\">其它配置</div>\n          <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            v-if=\"menuType==='C'\"\n            label=\"打开方式\"\n          >\n            <a-select\n              v-decorator=\"['target', {initialValue:'',rules: [{ required: false, message: '请选择打开方式' },{validator: validatePathTarget}]}]\"\n            >\n              <a-select-option :value=\"''\">当前窗口</a-select-option>\n              <a-select-option :value=\"'_blank'\">新窗口</a-select-option>\n            </a-select>\n          </a-form-item>\n\n          <a-form-item :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" v-if=\"menuType==='C'\">\n            <span slot=\"label\">链接地址</span>\n            <a-input\n              v-decorator=\"['path',{ rules: [ { required: false,type:'string', message: '请输入正确的路径' } ] }]\"\n              placeholder=\"路径\"\n            />\n          </a-form-item>\n\n          <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            v-if=\"menuType!=='F'\"\n            label=\"重定向地址\"\n          >\n            <a-input\n              v-decorator=\"['redirect',{rules: [{ required: false, message: '请输入重定向地址' }]}]\"\n              placeholder=\"重定向地址\"\n            />\n          </a-form-item>\n\n          <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            v-if=\"menuType!=='F'\"\n            label=\"隐藏子菜单\"\n          >\n            <a-switch v-decorator=\"['hiddenChildren',{initialValue:false}]\" />\n          </a-form-item>\n\n          <a-form-item :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" v-if=\"menuType!=='F'\">\n            <span slot=\"label\">隐藏头部信息</span>\n            <a-switch v-decorator=\"['hiddenHeader',{initialValue:false}]\" />\n          </a-form-item>\n\n          <a-form-item :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" label=\"显示顺序\">\n            <a-input-number\n              v-decorator=\"['orderNum',{initialValue:'1',rules: [{ required: true, message: '请输入顺序数字' }]}]\"\n              placeholder=\"显示顺序\"\n            />\n          </a-form-item>\n\n          <a-form-item :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" label=\"是否显示\">\n            <a-select\n              v-decorator=\"['visible', {initialValue:'0',rules: [{ required: true, message: '请选择是否显示' }]}]\"\n            >\n              <a-select-option :value=\"'0'\">显示</a-select-option>\n              <a-select-option :value=\"'1'\">隐藏</a-select-option>\n            </a-select>\n          </a-form-item>\n        </a-col>\n      </a-row>\n    </a-form>\n    <div class=\"modal-divider-text\">配置说明</div>\n    <div style=\"margin-left: 24px\">\n      <detail-list size=\"small\" :col=\"2\" class=\"detail-list-info\">\n        <detail-list-item term=\"上级权限\">当前菜单的父级菜单；</detail-list-item>\n        <detail-list-item term=\"权限类型\">当前菜单的类型，分为目录、菜单、按钮；</detail-list-item>\n      </detail-list>\n      <detail-list size=\"small\" :col=\"1\" class=\"detail-list-info\">\n        <detail-list-item\n          term=\"唯一标识\"\n        >当前菜单Rest风格的URL标识，如设置父菜单为system，当前菜单为permission，则URL为/system/permission;</detail-list-item>\n      </detail-list>\n      <detail-list size=\"small\" :col=\"1\" class=\"detail-list-info\">\n        <detail-list-item term=\"权限标识\">控制数据权限、接口权限、页面组件权限的唯一标识，如system:user:list,表示用户管理的列表权限;</detail-list-item>\n      </detail-list>\n      <detail-list size=\"small\" :col=\"1\" class=\"detail-list-info\">\n        <detail-list-item term=\"组件\">前端项目的routerUtil文件中定义的组件或views文件夹下的页面路径；</detail-list-item>\n      </detail-list>\n      <detail-list size=\"small\" :col=\"1\" class=\"detail-list-info\">\n        <detail-list-item term=\"打开方式\">点击菜单后在当前窗口或者在新窗口跳转路由；</detail-list-item>\n      </detail-list>\n      <detail-list size=\"small\" :col=\"1\" class=\"detail-list-info\">\n        <detail-list-item term=\"链接地址\">跳转路由的URL地址，为外部链接地址时，必须设置“打开方式”为新窗口；</detail-list-item>\n      </detail-list>\n      <detail-list size=\"small\" :col=\"1\" class=\"detail-list-info\">\n        <detail-list-item term=\"重定向地址\">当用户访问 /a时，URL 将会被替换成 /b，然后匹配路由为 /b；</detail-list-item>\n      </detail-list>\n      <detail-list size=\"small\" :col=\"1\" class=\"detail-list-info\">\n        <detail-list-item term=\"隐藏子菜单\">选择为true后，将不会在页面上显示当前菜单的所有子菜单；</detail-list-item>\n      </detail-list>\n      <detail-list size=\"small\" :col=\"2\" class=\"detail-list-info\">\n        <detail-list-item term=\"隐藏头部信息\">隐藏页面中的头部组件（面包屑）；</detail-list-item>\n        <detail-list-item term=\"是否显示\">显示或隐藏当前菜单及子菜单；</detail-list-item>\n      </detail-list>\n    </div>\n    <iconSelector-modal ref=\"modal\" @ok=\"setIcon\" :icon=\"icon\" />\n  </a-modal>\n</template>\n<script>\nimport { getPermissions, savePerm } from '@/api/system'\nimport pick from 'lodash.pick'\nimport IconSelectorModal from './IconSelectorModal.vue'\nimport DetailList from '@/components/tools/DetailList'\nconst DetailListItem = DetailList.Item\n\nexport default {\n  name: 'UserModal',\n  components: {\n    IconSelectorModal,\n    DetailList,\n    DetailListItem\n  },\n  data () {\n    return {\n      description:\n        '列表使用场景：后台管理中的权限管理以及角色管理，可用于基于 RBAC 设计的角色权限控制，颗粒度细到每一个操作类型。',\n      visible: false,\n      labelCol: {\n        xs: { span: 24 },\n        sm: { span: 6 }\n      },\n      wrapperCol: {\n        xs: { span: 24 },\n        sm: { span: 17 }\n      },\n      permissions: [{ key: 0, value: '0', title: '无' }],\n      mdl: {},\n      icon: 'smile',\n      menuType: '',\n      form: this.$form.createForm(this)\n    }\n  },\n  beforeCreate () { },\n  created () {\n    this.loadPermissions()\n  },\n  methods: {\n    menuTypeChange (type) {\n      this.menuType = type\n    },\n    emitEmpty () {\n      this.$refs.iconInput.focus()\n      this.form.setFieldsValue({ icon: '' })\n    },\n    iconselect () {\n      this.$refs.modal.show()\n    },\n    setIcon (icon) {\n      this.icon = icon\n      this.form.setFieldsValue({ icon: icon })\n    },\n    add (parentId) {\n      this.form.resetFields()\n      this.edit({ parentId: parentId || '0' })\n    },\n    edit (record) {\n      this.mdl = Object.assign({}, record)\n      this.visible = true\n      this.menuType = this.mdl.menuType || 'M'\n      this.$nextTick(() => {\n        this.mdl.icon ? (this.icon = this.mdl.icon) : (this.icon = 'smile')\n        this.mdl.parentId += ''\n        this.form.setFieldsValue(\n          pick(\n            this.mdl,\n            'icon',\n            'menuId',\n            'parentId',\n            'menuType',\n            'visible',\n            'perms',\n            'target',\n            'orderNum',\n            'menuName',\n            'menuKey',\n            'component',\n            'path',\n            'redirect',\n            'hiddenChildren',\n            'hiddenHeader'\n          )\n        )\n        // this.form.setFieldsValue({ ...record })\n      })\n    },\n    validatePathTarget (rule, value, callback) {\n      const path = this.form.getFieldValue('path')\n      if (path && path.startsWith('http') && value !== '_blank') {\n        callback(new Error('链接地址为外链时，打开方式必须为新窗口（antd限制）'))\n      } else {\n        callback()\n      }\n    },\n    loadPermissions () {\n      getPermissions().then((res) => {\n        this.buildtree(res.rows, this.permissions, 0)\n      })\n    },\n    buildtree (list, arr, parentId) {\n      list.forEach((item) => {\n        if (item.parentId === parentId) {\n          var child = {\n            key: item.menuId,\n            value: item.menuId + '',\n            title: item.menuName,\n            children: []\n          }\n          this.buildtree(list, child.children, item.menuId)\n          arr.push(child)\n        }\n      })\n    },\n    handleSubmit (e) {\n      e.preventDefault()\n      this.form.validateFields((err, values) => {\n        if (!err) {\n          this.confirmLoading = true\n          savePerm(values)\n            .then((res) => {\n              if (res.code === 0) {\n                this.$message.success('保存成功')\n                this.$emit('ok')\n                this.visible = false\n              } else {\n                this.$message.success(res.msg)\n              }\n            })\n            .catch(() => {\n              this.$message.error('系统错误，请稍后再试')\n            })\n            .finally(() => {\n              this.confirmLoading = false\n            })\n        }\n      })\n    }\n  },\n  watch: {\n    /*\n      'selectedRows': function (selectedRows) {\n        this.needTotalList = this.needTotalList.map(item => {\n          return {\n            ...item,\n            total: selectedRows.reduce( (sum, val) => {\n              return sum + val[item.dataIndex]\n            }, 0)\n          }\n        })\n      }\n      */\n  }\n}\n</script>\n<style lang=\"less\">\n.detail-list-info {\n  .term {\n    color: #d2000099 !important;\n    padding-bottom: 6px !important;\n  }\n  .content {\n    color: #a5a4a4 !important;\n    padding-bottom: 6px !important;\n  }\n}\n</style>\n"]}]}