{"remainingRequest":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/src/views/system/modules/SysTopMenuModal.vue?vue&type=style&index=0&lang=less&","dependencies":[{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/src/views/system/modules/SysTopMenuModal.vue","mtime":1605568762478},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/less-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5kZXRhaWwtbGlzdC1pbmZvIHsKICAudGVybSB7CiAgICBjb2xvcjogI2QyMDAwMDk5ICFpbXBvcnRhbnQ7CiAgICBwYWRkaW5nLWJvdHRvbTogNnB4ICFpbXBvcnRhbnQ7CiAgfQogIC5jb250ZW50IHsKICAgIGNvbG9yOiAjYTVhNGE0ICFpbXBvcnRhbnQ7CiAgICBwYWRkaW5nLWJvdHRvbTogNnB4ICFpbXBvcnRhbnQ7CiAgfQp9Cg=="},{"version":3,"sources":["SysTopMenuModal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"SysTopMenuModal.vue","sourceRoot":"src/views/system/modules","sourcesContent":["<template>\n  <a-modal title=\"操作\"\n           style=\"top: 20px;\"\n           :width=\"1000\"\n           v-model=\"visible\"\n           :bodyStyle=\"{ height: '600px',padding: 0 }\"\n           :confirmLoading=\"confirmLoading\"\n           @ok=\"handleSubmit\">\n    <venus-scroll :only-show-bar-on-scroll=\"false\">\n      <div style=\"padding: 24px\">\n        <a-form :form=\"form\">\n          <a-row :gutter=\"64\">\n            <a-col :span=\"12\"\n                   style=\"border-right: 1px solid #eaeaea\">\n              <div class=\"modal-divider-text\">基本配置</div>\n              <a-form-item style=\"display:none\">\n                <a-input v-decorator=\"['id']\" />\n              </a-form-item>\n              <a-form-item style=\"display:none\">\n                <a-input v-decorator=\"['icon']\" />\n              </a-form-item>\n              <a-form-item :labelCol=\"labelCol\"\n                           :wrapperCol=\"wrapperCol\"\n                           label=\"主菜单名称\">\n                <a-input placeholder=\"主菜单名称\"\n                         v-decorator=\"['name',{rules: [{ required: true, message: '请输入主菜单名称' }]}]\" />\n              </a-form-item>\n              <a-form-item :labelCol=\"labelCol\"\n                           :wrapperCol=\"wrapperCol\"\n                           label=\"是否显示\">\n                <a-select v-decorator=\"['visible', {initialValue:'0',rules: [{ required: true, message: '是否显示' }]}]\">\n                  <a-select-option v-for=\"(b, index) in visibleArry\"\n                                   :key=\"index\"\n                                   :value=\"b.dictValue\">{{ b.dictLabel }}</a-select-option>\n                </a-select>\n              </a-form-item>\n              <a-form-item :labelCol=\"labelCol\"\n                           :wrapperCol=\"wrapperCol\"\n                           label=\"菜单图标\">\n                <!-- <a-input placeholder=\"菜单图标\" v-decorator=\"['icon']\" /> -->\n                <s-upload list-type=\"picture\"\n                          accept-type=\"jpeg,png,svg+xml,ico\"\n                          max-size=\"20\"\n                          max-length=\"1\"\n                          ref=\"upload\"\n                          @success=\"uploadSuccess\"\n                          is-open=\"true\"\n                          v-decorator=\"['assignedId',{initialValue: '',rules: [{ required: true, message: '请上传菜单图标' }]}]\" />\n              </a-form-item>\n              <!-- <a-form-item :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" label=\"权限标识\">\n        <a-input placeholder=\"权限标识\" v-decorator=\"['perms']\" />\n              </a-form-item>-->\n              <a-form-item :labelCol=\"labelCol\"\n                           :wrapperCol=\"wrapperCol\"\n                           label=\"主菜单排序\">\n                <a-input-number v-decorator=\"['orderNum',{initialValue:1,rules: [{ required: true, message: '请输入顺序数字' }]}]\"\n                                placeholder=\"显示顺序\" />\n              </a-form-item>\n              <div class=\"modal-divider-text\">首页配置</div>\n              <a-form-item :labelCol=\"labelCol\"\n                           :wrapperCol=\"wrapperCol\"\n                           label=\"首页唯一标识\">\n                <a-input placeholder=\"唯一标识\"\n                         v-decorator=\"['code']\" />\n              </a-form-item>\n              <a-form-item :labelCol=\"labelCol\"\n                           :wrapperCol=\"wrapperCol\"\n                           label=\"首页地址\">\n                <a-input placeholder=\"首页地址\"\n                         v-decorator=\"['component']\" />\n              </a-form-item>\n              <a-form-item :labelCol=\"labelCol\"\n                           :wrapperCol=\"wrapperCol\"\n                           label=\"首页名称\">\n                <a-input placeholder=\"首页名称\"\n                         v-decorator=\"['source']\" />\n              </a-form-item>\n              <div class=\"modal-divider-text\">链接配置</div>\n              <a-form-item :labelCol=\"labelCol\"\n                           :wrapperCol=\"wrapperCol\"\n                           label=\"打开方式\">\n                <a-select v-decorator=\"['target', {initialValue:'',rules: [{ required: false, message: '请选择打开方式' },{validator: validatePathTarget}]}]\">\n                  <a-select-option :value=\"''\">当前窗口</a-select-option>\n                  <a-select-option :value=\"'_blank'\">新窗口</a-select-option>\n                </a-select>\n              </a-form-item>\n              <a-form-item :labelCol=\"labelCol\"\n                           :wrapperCol=\"wrapperCol\">\n                <span slot=\"label\">链接地址</span>\n                <a-input placeholder=\"路径\"\n                         v-decorator=\"['redirect',{\n                           rules: [\n                             { required: false,type:'string', message: '请输入正确的路径' }\n                           ]\n                         }]\" />\n              </a-form-item>\n            </a-col>\n            <a-col :span=\"12\">\n              <div class=\"modal-divider-text\">布局配置</div>\n              <a-form-item :labelCol=\"labelCol\"\n                           :wrapperCol=\"wrapperCol\"\n                           label=\"导航模式\">\n                <a-select @change=\"layoutModeChange\"\n                          v-decorator=\"['layoutMode', {initialValue:'sidemenu',rules: [{ required: true, message: '请选择导航模式' }]}]\">\n                  <a-select-option v-for=\"(b, index) in layoutModeArry\"\n                                   :key=\"index\"\n                                   :value=\"b.dictValue\">{{ b.dictLabel }}</a-select-option>\n                </a-select>\n              </a-form-item>\n              <a-form-item :labelCol=\"labelCol\"\n                           :wrapperCol=\"wrapperCol\"\n                           label=\"多页签模式\">\n                <a-switch :disabled=\"layoutMode === 'topmenu'\"\n                          v-decorator=\"['multiTab',{initialValue: true,valuePropName: 'checked',rules: [{ required: true, message: '请选择多页签模式' }]}]\" />\n              </a-form-item>\n              <div class=\"modal-divider-text\">权限配置</div>\n              <a-form-item :labelCol=\"labelCol\"\n                           :wrapperCol=\"wrapperCol\"\n                           label=\"拥有权限\">\n                <a-tree checkable\n                        v-model=\"checkedKeys\"\n                        @check=\"onCheck\"\n                        :treeData=\"permissions\"></a-tree>\n              </a-form-item>\n            </a-col>\n          </a-row>\n        </a-form>\n        <div class=\"modal-divider-text\">配置说明</div>\n        <div style=\"margin-left: 24px\">\n          <detail-list size=\"small\"\n                       :col=\"2\"\n                       class=\"detail-list-info\">\n            <detail-list-item term=\"唯一标识\">主菜单的唯一标识，如：system;</detail-list-item>\n            <detail-list-item term=\"首页地址\">每个主菜单的欢迎页地址;</detail-list-item>\n          </detail-list>\n          <detail-list size=\"small\"\n                       :col=\"2\"\n                       class=\"detail-list-info\">\n            <detail-list-item term=\"首页名称\">为多页签模式情况下，页签显示的名称；</detail-list-item>\n            <detail-list-item term=\"打开方式\">点击菜单后在当前窗口或者在新窗口跳转路由；</detail-list-item>\n          </detail-list>\n          <detail-list size=\"small\"\n                       :col=\"1\"\n                       class=\"detail-list-info\">\n            <detail-list-item term=\"链接地址\">跳转路由的URL地址，为外部链接地址时，必须设置“打开方式”为新窗口；</detail-list-item>\n          </detail-list>\n          <detail-list size=\"small\"\n                       :col=\"2\"\n                       class=\"detail-list-info\">\n            <detail-list-item term=\"导航模式\">主菜单下的菜单为侧边栏导航或顶部栏导航布局；</detail-list-item>\n            <detail-list-item term=\"拥有权限\">分配主菜单下的菜单；</detail-list-item>\n          </detail-list>\n          <detail-list size=\"small\"\n                       :col=\"1\"\n                       class=\"detail-list-info\">\n            <detail-list-item term=\"多页签模式\">主菜单下的菜单设置是否为多页签路由布局模式，导航模式为“顶部栏导航”时，必须为<span style=\"color: #faad14\">单页签模式</span>；</detail-list-item>\n          </detail-list>\n        </div>\n      </div>\n    </venus-scroll>\n  </a-modal>\n</template>\n<script>\nimport { getPermissions, getMenuPermIds, saveSysTopMenu } from '@/api/system'\nimport pick from 'lodash.pick'\nimport { getDictArray } from '@/utils/dict'\nimport SUpload from '@/components/pts/Upload'\nimport VenusScroll from '@/components/pts/Scroll'\nimport DetailList from '@/components/tools/DetailList'\nconst DetailListItem = DetailList.Item\n\nexport default {\n  name: 'SysTopMenuModal',\n  props: {},\n  components: {\n    SUpload,\n    DetailList,\n    DetailListItem,\n    VenusScroll\n  },\n  data() {\n    return {\n      visible: false,\n      labelCol: {\n        xs: { span: 24 },\n        sm: { span: 6 }\n      },\n      wrapperCol: {\n        xs: { span: 24 },\n        sm: { span: 18 }\n      },\n      confirmLoading: false,\n      mdl: {},\n      layoutModeArry: [],\n      visibleArry: [],\n      form: this.$form.createForm(this),\n      permissions: [],\n      treeCheck: false,\n      pidSet: [],\n      checkedKeys: [],\n      halfCheckedKeys: [],\n      layoutMode: ''\n    }\n  },\n  beforeCreate() { },\n  async created() {\n    this.layoutModeArry = await getDictArray('layout_mode')\n    this.visibleArry = await getDictArray('sys_show_hide')\n    this.loadPermissions()\n  },\n  methods: {\n    layoutModeChange(value) {\n      this.layoutMode = value\n      if (value === 'topmenu') {\n        this.form.setFieldsValue({ multiTab: false })\n      }\n    },\n    add() {\n      this.form.resetFields()\n      this.checkedKeys = []\n      this.pidSet = []\n      this.edit({ id: 0 })\n    },\n    edit(record) {\n      this.layoutMode = ''\n      if (record.id !== 0) {\n        getMenuPermIds(record.id).then(res => {\n          const pidSet = new Set(res.map(m => m.parentId).filter(id => id > 0))\n          this.pidSet = pidSet\n          // 因为antd 树插件勾选父节点会导致所有子节点选中,所以过滤所有父节点\n          this.checkedKeys = res.map(m => m.menuId).filter(id => !pidSet.has(id))\n        })\n      }\n      this.mdl = Object.assign(record)\n      this.mdl.multiTab = this.mdl.multiTab === 'true' || this.mdl.multiTab === true || this.mdl.multiTab === undefined\n      this.mdl.assignedId = this.mdl.busId || null\n      this.treeCheck = false\n      this.visible = true\n      this.$nextTick(() => {\n        this.form.setFieldsValue(\n          pick(\n            this.mdl,\n            'id',\n            'code',\n            'name',\n            'component',\n            'source',\n            'target',\n            // 'perms',\n            'icon',\n            'redirect',\n            'visible',\n            'layoutMode',\n            'multiTab',\n            'orderNum',\n            'assignedId'\n          )\n        )\n      })\n    },\n    validatePathTarget(rule, value, callback) {\n      const redirect = this.form.getFieldValue('redirect')\n      if (redirect && redirect.startsWith('http') && value !== '_blank') {\n        callback(new Error('链接地址为外链时，打开方式必须为新窗口（antd限制）'))\n      } else {\n        callback()\n      }\n    },\n    onCheck(checkedKeys, info) {\n      if (!this.treeCheck) this.treeCheck = true\n      this.checkedKeys = checkedKeys\n      this.halfCheckedKeys = info.halfCheckedKeys\n    },\n    loadPermissions() {\n      getPermissions().then(res => {\n        this.buildtree(res.rows, this.permissions, 0)\n      })\n    },\n    buildtree(list, permissions, parentId) {\n      list.forEach(item => {\n        if (item.parentId === parentId) {\n          var child = {\n            key: item.menuId,\n            title: item.menuName,\n            children: []\n          }\n          this.buildtree(list, child.children, item.menuId)\n          permissions.push(child)\n        }\n      })\n    },\n    uploadSuccess(res) {\n      // console.log(res.filePath)\n      this.form.setFieldsValue({ icon: res.filePath })\n    },\n    handleSubmit(e) {\n      e.preventDefault()\n      const _this = this\n      // 如果没有check过，半选节点是拿不到的，只能通过预先设置的pidSet获取\n      const checkedAll = this.treeCheck\n        ? _this.checkedKeys.concat(_this.halfCheckedKeys)\n        : _this.checkedKeys.concat(Array.from(_this.pidSet))\n      // if (!checkedAll.length > 0) {\n      //   _this.$message.warning('请至少选择一个权限')\n      //   return\n      // }\n      this.form.validateFields((err, values) => {\n        if (!err) {\n          if (this.$refs.upload.sFileList.length > 0) {\n            values.menuIds = checkedAll\n            values.id = values.id === 0 ? '' : values.id\n            this.confirmLoading = true\n            saveSysTopMenu(values)\n              .then(res => {\n                if (res.code === 0) {\n                  this.$message.success('保存成功')\n                  this.$emit('ok')\n                  this.visible = false\n                } else {\n                  this.$message.error(res.msg)\n                }\n              })\n              .catch(() => {\n                this.$message.error('系统错误，请稍后再试')\n              })\n              .finally(() => {\n                this.confirmLoading = false\n              })\n          } else {\n            this.$message.error('请上传菜单图标')\n          }\n        }\n      })\n    }\n  },\n  watch: {\n    /*\n      'selectedRows': function (selectedRows) {\n        this.needTotalList = this.needTotalList.map(item => {\n          return {\n            ...item,\n            total: selectedRows.reduce( (sum, val) => {\n              return sum + val[item.dataIndex]\n            }, 0)\n          }\n        })\n      }\n      */\n  }\n}\n</script>\n<style lang=\"less\">\n.detail-list-info {\n  .term {\n    color: #d2000099 !important;\n    padding-bottom: 6px !important;\n  }\n  .content {\n    color: #a5a4a4 !important;\n    padding-bottom: 6px !important;\n  }\n}\n</style>\n"]}]}