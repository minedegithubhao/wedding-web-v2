{"remainingRequest":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/src/views/activiti/modules/Leave.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/src/views/activiti/modules/Leave.vue","mtime":1605568762450},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGdldERpY3RBcnJheSB9IGZyb20gJ0AvdXRpbHMvZGljdCcKaW1wb3J0IHsgc2F2ZUxlYXZlIH0gZnJvbSAnQC9hcGkvYWN0aXZpdGknCmltcG9ydCBwaWNrIGZyb20gJ2xvZGFzaC5waWNrJwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ0xlYXZlRm9ybScsCiAgZGF0YSAoKSB7CiAgICByZXR1cm4gewogICAgICBsYWJlbENvbDogewogICAgICAgIGxnOiB7IHNwYW46IDcgfSwgc206IHsgc3BhbjogNyB9CiAgICAgIH0sCiAgICAgIHdyYXBwZXJDb2w6IHsKICAgICAgICBsZzogeyBzcGFuOiAxMCB9LCBzbTogeyBzcGFuOiAxNyB9CiAgICAgIH0sCiAgICAgIGNvbmZpcm1Mb2FkaW5nOiBmYWxzZSwKICAgICAgbGVhdmVUeXBlczogW10sCiAgICAgIGZvcm1EYXRhOiB7fSwKICAgICAgLy8gZm9ybQogICAgICBmb3JtOiB0aGlzLiRmb3JtLmNyZWF0ZUZvcm0odGhpcykKCiAgICB9CiAgfSwKICBhc3luYyBjcmVhdGVkICgpIHsKICAgIGNvbnN0IHF1ZXJ5ID0gdGhpcy4kcm91dGUucXVlcnkKICAgIHRoaXMuZm9ybURhdGEgPSBPYmplY3QuYXNzaWduKHBpY2socXVlcnksICdrZXknLCAncHJvY0RlZklkJywgJ3Byb2NOYW1lJykpCiAgICB0aGlzLmxlYXZlVHlwZXMgPSBhd2FpdCBnZXREaWN0QXJyYXkoJ2FjdF9sZWF2ZV90eXBlJykKICB9LAogIG1ldGhvZHM6IHsKICAgIG9uT2sgKHYpIHsKICAgICAgaWYgKHZbMF0pIHsKICAgICAgICBjb25zdCBzdGFydERhdGUgPSB2WzBdCiAgICAgICAgY29uc3QgZW5kRGF0ZSA9IHZbMV0KICAgICAgICBjb25zdCBkdXJhdGlvbiA9IGVuZERhdGUuZGlmZihzdGFydERhdGUsICdob3VycycsIHRydWUpLnRvRml4ZWQoMikKICAgICAgICB0aGlzLmZvcm0uc2V0RmllbGRzVmFsdWUoeyBkdXJhdGlvbjogZHVyYXRpb24gfSkKICAgICAgICB0aGlzLmZvcm1EYXRhID0gT2JqZWN0LmFzc2lnbih0aGlzLmZvcm1EYXRhLCB7IHN0YXJ0RGF0ZTogc3RhcnREYXRlLmZvcm1hdCgnWVlZWS1NTS1ERCBISDptbTowMCcpLCBlbmREYXRlOiBlbmREYXRlLmZvcm1hdCgnWVlZWS1NTS1ERCBISDptbTowMCcpIH0pCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5mb3JtLnNldEZpZWxkc1ZhbHVlKHsgZHVyYXRpb246IDAgfSkKICAgICAgICB0aGlzLmZvcm1EYXRhID0gT2JqZWN0LmFzc2lnbih0aGlzLmZvcm1EYXRhLCB7IHN0YXJ0RGF0ZTogJycsIGVuZERhdGU6ICcnIH0pCiAgICAgIH0KICAgIH0sCiAgICB2YWxpZGF0ZUR1cmF0aW9uIChydWxlLCB2YWx1ZSwgY2FsbGJhY2spIHsKICAgICAgaWYgKHZhbHVlID4gMCkgewogICAgICAgIGNhbGxiYWNrKCkKICAgICAgfSBlbHNlIHsKICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoJ+aXtumVv+W/hemhu+Wkp+S6jjAnKSkKICAgICAgfQogICAgfSwKICAgIC8vIGhhbmRsZXIKICAgIGhhbmRsZVN1Ym1pdCAoZSkgewogICAgICBlLnByZXZlbnREZWZhdWx0KCkKICAgICAgdGhpcy5mb3JtLnZhbGlkYXRlRmllbGRzKChlcnIsIHZhbHVlcykgPT4gewogICAgICAgIGlmICghZXJyKSB7CiAgICAgICAgICB2YWx1ZXMgPSBPYmplY3QuYXNzaWduKHZhbHVlcywgdGhpcy5mb3JtRGF0YSkKICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlCiAgICAgICAgICBjb25zb2xlLmxvZygnUmVjZWl2ZWQgdmFsdWVzIG9mIGZvcm06ICcsIHZhbHVlcykKICAgICAgICAgIHRoaXMuY29uZmlybUxvYWRpbmcgPSB0cnVlCiAgICAgICAgICBzYXZlTGVhdmUodmFsdWVzKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgIGlmIChyZXMuY29kZSA9PT0gMCkgewogICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygn5L+d5a2Y5oiQ5YqfJykKICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7IG5hbWU6ICdidXNpbmVzc0xpc3QnIH0pCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXMubXNnKQogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+ezu+e7n+mUmeivr++8jOivt+eojeWQjuWGjeivlScpCiAgICAgICAgICB9KS5maW5hbGx5KCgpID0+IHsKICAgICAgICAgICAgdGhpcy5jb25maXJtTG9hZGluZyA9IGZhbHNlCiAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgfSkKICAgIH0KICB9Cn0K"},{"version":3,"sources":["Leave.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Leave.vue","sourceRoot":"src/views/activiti/modules","sourcesContent":["<template>\n  <a-card :body-style=\"{padding: '24px 32px'}\" :bordered=\"false\">\n    <a-form @submit=\"handleSubmit\" :form=\"form\">\n      <a-form-item\n        label=\"请假类型\"\n        :labelCol=\"labelCol\"\n        :wrapperCol=\"wrapperCol\">\n        <a-select placeholder=\"层级\" v-decorator=\"['type', {initialValue:'1',rules: [{ required: true, message: '请选择请假类型' }]}]\">\n          <a-select-option v-for=\"(d, index) in leaveTypes\" :key=\"index\" :value=\"d.dictValue\">{{ d.dictLabel }}</a-select-option>\n        </a-select>\n      </a-form-item>\n      <a-form-item\n        label=\"标题\"\n        :labelCol=\"labelCol\"\n        :wrapperCol=\"wrapperCol\">\n        <a-input\n          v-decorator=\"[\n            'title',\n            {rules: [{ required: true, message: '请输入标题' }]}\n          ]\"\n          placeholder=\"请假标题\" />\n      </a-form-item>\n      <a-form-item\n        label=\"起止日期\"\n        :labelCol=\"labelCol\"\n        :wrapperCol=\"wrapperCol\">\n        <a-range-picker\n          :showTime=\"{ format: 'HH:mm' }\"\n          format=\"YYYY-MM-DD HH:mm\"\n          style=\"width: 100%\"\n          @ok=\"onOk\"\n          v-decorator=\"[\n            'buildTime',\n            {rules: [{ required: true, message: '请选择起止日期' }]}\n          ]\" />\n      </a-form-item>\n      <a-form-item\n        label=\"时长\"\n        :labelCol=\"labelCol\"\n        :wrapperCol=\"wrapperCol\">\n\n        <a-input\n          style=\"width: 150px;\"\n          addonAfter=\"小时\"\n          disabled\n          v-decorator=\"[\n            'duration',\n            {initialValue:0,rules: [\n              { required: true},\n              {validator: validateDuration}\n            ]}\n          ]\"\n        />\n      </a-form-item>\n      <a-form-item\n        label=\"描述\"\n        :labelCol=\"labelCol\"\n        :wrapperCol=\"wrapperCol\">\n        <a-textarea\n          rows=\"4\"\n          placeholder=\"请输入描述\"\n          v-decorator=\"[\n            'description',\n            {rules: [{ required: true, message: '请输入描述' }]}\n          ]\" />\n      </a-form-item>\n      <a-form-item\n        :wrapperCol=\"{ span: 24 }\"\n        style=\"text-align: center\"\n      >\n        <a-button htmlType=\"submit\" type=\"primary\" :loading=\"confirmLoading\">提交</a-button>\n        <router-link :to=\"{name:'businessList'}\"><a-button style=\"margin-left: 8px\">返回</a-button></router-link>\n      </a-form-item>\n    </a-form>\n  </a-card>\n</template>\n\n<script>\nimport { getDictArray } from '@/utils/dict'\nimport { saveLeave } from '@/api/activiti'\nimport pick from 'lodash.pick'\nexport default {\n  name: 'LeaveForm',\n  data () {\n    return {\n      labelCol: {\n        lg: { span: 7 }, sm: { span: 7 }\n      },\n      wrapperCol: {\n        lg: { span: 10 }, sm: { span: 17 }\n      },\n      confirmLoading: false,\n      leaveTypes: [],\n      formData: {},\n      // form\n      form: this.$form.createForm(this)\n\n    }\n  },\n  async created () {\n    const query = this.$route.query\n    this.formData = Object.assign(pick(query, 'key', 'procDefId', 'procName'))\n    this.leaveTypes = await getDictArray('act_leave_type')\n  },\n  methods: {\n    onOk (v) {\n      if (v[0]) {\n        const startDate = v[0]\n        const endDate = v[1]\n        const duration = endDate.diff(startDate, 'hours', true).toFixed(2)\n        this.form.setFieldsValue({ duration: duration })\n        this.formData = Object.assign(this.formData, { startDate: startDate.format('YYYY-MM-DD HH:mm:00'), endDate: endDate.format('YYYY-MM-DD HH:mm:00') })\n      } else {\n        this.form.setFieldsValue({ duration: 0 })\n        this.formData = Object.assign(this.formData, { startDate: '', endDate: '' })\n      }\n    },\n    validateDuration (rule, value, callback) {\n      if (value > 0) {\n        callback()\n      } else {\n        callback(new Error('时长必须大于0'))\n      }\n    },\n    // handler\n    handleSubmit (e) {\n      e.preventDefault()\n      this.form.validateFields((err, values) => {\n        if (!err) {\n          values = Object.assign(values, this.formData)\n          // eslint-disable-next-line no-console\n          console.log('Received values of form: ', values)\n          this.confirmLoading = true\n          saveLeave(values).then(res => {\n            if (res.code === 0) {\n              this.$message.success('保存成功')\n              this.$router.push({ name: 'businessList' })\n            } else {\n              this.$message.error(res.msg)\n            }\n          }).catch(() => {\n            this.$message.error('系统错误，请稍后再试')\n          }).finally(() => {\n            this.confirmLoading = false\n          })\n        }\n      })\n    }\n  }\n}\n</script>\n"]}]}