{"remainingRequest":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/babel-loader/lib/index.js!/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/eslint-loader/index.js??ref--13-0!/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/src/permission.js","dependencies":[{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/src/permission.js","mtime":1605568762437},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lIjsKaW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiL1VzZXJzL2N4ZHBjL1dvcmtTcGFjZXMvaWRlYV93b3Jrc3BhY2Uvd2VkZGluZy13ZWIvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL29iamVjdFNwcmVhZDIiOwppbXBvcnQgVnVlIGZyb20gJ3Z1ZSc7CmltcG9ydCByb3V0ZXIgZnJvbSAnLi9yb3V0ZXInOwppbXBvcnQgc3RvcmUgZnJvbSAnLi9zdG9yZSc7CmltcG9ydCBOUHJvZ3Jlc3MgZnJvbSAnbnByb2dyZXNzJzsgLy8gcHJvZ3Jlc3MgYmFyCgppbXBvcnQgJ25wcm9ncmVzcy9ucHJvZ3Jlc3MuY3NzJzsgLy8gcHJvZ3Jlc3MgYmFyIHN0eWxlCgppbXBvcnQgeyBub3RpZmljYXRpb24gfSBmcm9tICdhbnQtZGVzaWduLXZ1ZSc7CmltcG9ydCB7IEFDQ0VTU19UT0tFTiwgQ1VSUkVOVF9UT1BfTUVOVSB9IGZyb20gJ0Avc3RvcmUvbXV0YXRpb24tdHlwZXMnOwppbXBvcnQgeyBnZXRTZXNzaW9uU3RvcmFnZSwgc2V0U2Vzc2lvblN0b3JhZ2UgfSBmcm9tICdAL3V0aWxzL3V0aWwnOwpOUHJvZ3Jlc3MuY29uZmlndXJlKHsKICBzaG93U3Bpbm5lcjogZmFsc2UKfSk7IC8vIE5Qcm9ncmVzcyBDb25maWd1cmF0aW9uCgp2YXIgd2hpdGVMaXN0ID0gWydsb2dpbicsICdyZWdpc3RlcicsICdyZWdpc3RlclJlc3VsdCcsICdwb3J0YWxDbGllbnQnXTsgLy8gbm8gcmVkaXJlY3Qgd2hpdGVsaXN0Ci8vIOWJjeerr+acquaJvuWIsOmhtemdoui3r+eUse+8iOWbuuWumuS4jeeUqOaUue+8iQoKdmFyIG5vdEZvdW5kUm91dGVyID0gewogIHBhdGg6ICcqJywKICByZWRpcmVjdDogJy80MDQnLAogIGhpZGRlbjogdHJ1ZQp9Owpyb3V0ZXIuYmVmb3JlRWFjaChmdW5jdGlvbiAodG8sIGZyb20sIG5leHQpIHsKICBOUHJvZ3Jlc3Muc3RhcnQoKTsgLy8gc3RhcnQgcHJvZ3Jlc3MgYmFyCgogIGlmIChWdWUubHMuZ2V0KEFDQ0VTU19UT0tFTikpIHsKICAgIC8qIGhhcyB0b2tlbiAqLwogICAgaWYgKHRvLnBhdGggPT09ICcvdXNlci9sb2dpbicpIHsKICAgICAgLy8gbmV4dCh7IHBhdGg6ICcvZGFzaGJvYXJkL3dvcmtwbGFjZScgfSkKICAgICAgbmV4dCgpOwogICAgICBOUHJvZ3Jlc3MuZG9uZSgpOwogICAgfSBlbHNlIHsKICAgICAgaWYgKHN0b3JlLmdldHRlcnMucm9sZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgc3RvcmUuZGlzcGF0Y2goJ0dldEluZm8nKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIC8vIOWFiOiOt+WPluS4u+iPnOWNlQogICAgICAgICAgc3RvcmUuZGlzcGF0Y2goJ0dldFRvcE1lbnUnKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnRUb3BNZW51ID0gZ2V0U2Vzc2lvblN0b3JhZ2UoQ1VSUkVOVF9UT1BfTUVOVSk7CgogICAgICAgICAgICBpZiAoIWN1cnJlbnRUb3BNZW51KSB7CiAgICAgICAgICAgICAgdmFyIHRvcE1lbnUgPSBzdG9yZS5nZXR0ZXJzLnRvcE1lbnVMaXN0OwogICAgICAgICAgICAgIGN1cnJlbnRUb3BNZW51ID0gdG9wTWVudVswXSAmJiB0b3BNZW51WzBdLmlkIHx8ICcxJzsKICAgICAgICAgICAgICBzZXRTZXNzaW9uU3RvcmFnZShDVVJSRU5UX1RPUF9NRU5VLCBjdXJyZW50VG9wTWVudSk7CiAgICAgICAgICAgIH0gLy8g6LCD55SoIHZ1ZXgg55qEIOS7juWQjuerr+iOt+WPlueUqOaIt+eahOi3r+eUseiPnOWNle+8jOWKqOaAgea3u+WKoOWPr+iuv+mXrui3r+eUseihqAoKCiAgICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKCdHZW5lcmF0ZVJvdXRlcycsIHsKICAgICAgICAgICAgICBjdXJyZW50VG9wTWVudTogY3VycmVudFRvcE1lbnUKICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgLy8g5oqK5bey6I635Y+W5Yiw55qE6Lev55Sx6I+c5Y2V5Yqg5YWl5Yiw6Lev55Sx6KGo5LitCiAgICAgICAgICAgICAgdmFyIHJvdXRlID0gc3RvcmUuZ2V0dGVycy5hZGRSb3V0ZXJzOwogICAgICAgICAgICAgIHZhciByb3V0ZU1hcCA9IFtdOwoKICAgICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gcm91dGUpIHsKICAgICAgICAgICAgICAgIHJvdXRlTWFwID0gcm91dGVNYXAuY29uY2F0KHJvdXRlW2tleV0pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcm91dGVNYXAucHVzaChub3RGb3VuZFJvdXRlcik7CiAgICAgICAgICAgICAgcm91dGVyLmFkZFJvdXRlcyhyb3V0ZU1hcCk7CiAgICAgICAgICAgICAgdmFyIHJlZGlyZWN0ID0gZGVjb2RlVVJJQ29tcG9uZW50KGZyb20ucXVlcnkucmVkaXJlY3QgfHwgdG8ucGF0aCk7CgogICAgICAgICAgICAgIGlmICh0by5wYXRoID09PSByZWRpcmVjdCkgewogICAgICAgICAgICAgICAgLy8gaGFja+aWueazlSDnoa7kv51hZGRSb3V0ZXPlt7LlrozmiJAgLHNldCB0aGUgcmVwbGFjZTogdHJ1ZSBzbyB0aGUgbmF2aWdhdGlvbiB3aWxsIG5vdCBsZWF2ZSBhIGhpc3RvcnkgcmVjb3JkCiAgICAgICAgICAgICAgICBuZXh0KF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgdG8pLCB7fSwgewogICAgICAgICAgICAgICAgICByZXBsYWNlOiB0cnVlCiAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIOi3s+i9rOWIsOebrueahOi3r+eUsQogICAgICAgICAgICAgICAgbmV4dCh7CiAgICAgICAgICAgICAgICAgIHBhdGg6IHJlZGlyZWN0CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgICAgbm90aWZpY2F0aW9uLmVycm9yKHsKICAgICAgICAgICAgbWVzc2FnZTogJ+mUmeivrycsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAn6K+35rGC55So5oi35L+h5oGv5aSx6LSl77yM6K+36YeN6K+VJwogICAgICAgICAgfSk7CiAgICAgICAgICBzdG9yZS5kaXNwYXRjaCgnTG9nb3V0JykudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIG5leHQoewogICAgICAgICAgICAgIHBhdGg6ICcvdXNlci9sb2dpbicsCiAgICAgICAgICAgICAgcXVlcnk6IHsKICAgICAgICAgICAgICAgIHJlZGlyZWN0OiB0by5mdWxsUGF0aAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBuZXh0KCk7CiAgICAgIH0KICAgIH0KICB9IGVsc2UgewogICAgaWYgKHdoaXRlTGlzdC5pbmNsdWRlcyh0by5uYW1lKSkgewogICAgICAvLyDlnKjlhY3nmbvlvZXnmb3lkI3ljZXvvIznm7TmjqXov5vlhaUKICAgICAgbmV4dCgpOwogICAgfSBlbHNlIHsKICAgICAgaWYgKHRvLmZ1bGxQYXRoICE9PSAnLycgJiYgdG8uZnVsbFBhdGggIT09ICcnKSB7CiAgICAgICAgbmV4dCh7CiAgICAgICAgICBwYXRoOiAnL3VzZXIvbG9naW4nLAogICAgICAgICAgcXVlcnk6IHsKICAgICAgICAgICAgcmVkaXJlY3Q6IHRvLmZ1bGxQYXRoCiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbmV4dCh7CiAgICAgICAgICBwYXRoOiAnL3BvcnRhbENsaWVudC9pbmRleCcKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgTlByb2dyZXNzLmRvbmUoKTsgLy8gaWYgY3VycmVudCBwYWdlIGlzIGxvZ2luIHdpbGwgbm90IHRyaWdnZXIgYWZ0ZXJFYWNoIGhvb2ssIHNvIG1hbnVhbGx5IGhhbmRsZSBpdAogICAgfQogIH0KfSk7CnJvdXRlci5hZnRlckVhY2goZnVuY3Rpb24gKCkgewogIE5Qcm9ncmVzcy5kb25lKCk7IC8vIGZpbmlzaCBwcm9ncmVzcyBiYXIKfSk7"},{"version":3,"sources":["/Users/cxdpc/WorkSpaces/idea_workspace/wedding-web/src/permission.js"],"names":["Vue","router","store","NProgress","notification","ACCESS_TOKEN","CURRENT_TOP_MENU","getSessionStorage","setSessionStorage","configure","showSpinner","whiteList","notFoundRouter","path","redirect","hidden","beforeEach","to","from","next","start","ls","get","done","getters","roles","length","dispatch","then","currentTopMenu","topMenu","topMenuList","id","route","addRouters","routeMap","key","concat","push","addRoutes","decodeURIComponent","query","replace","catch","error","message","description","fullPath","includes","name","afterEach"],"mappings":"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","sourcesContent":["import Vue from 'vue'\nimport router from './router'\nimport store from './store'\n\nimport NProgress from 'nprogress' // progress bar\nimport 'nprogress/nprogress.css' // progress bar style\nimport { notification } from 'ant-design-vue'\nimport { ACCESS_TOKEN, CURRENT_TOP_MENU } from '@/store/mutation-types'\n\nimport { getSessionStorage, setSessionStorage } from '@/utils/util'\n\nNProgress.configure({ showSpinner: false }) // NProgress Configuration\n\nconst whiteList = ['login', 'register', 'registerResult', 'portalClient'] // no redirect whitelist\n// 前端未找到页面路由（固定不用改）\nconst notFoundRouter = {\n  path: '*',\n  redirect: '/404',\n  hidden: true\n}\n\nrouter.beforeEach((to, from, next) => {\n  NProgress.start() // start progress bar\n\n  if (Vue.ls.get(ACCESS_TOKEN)) {\n    /* has token */\n    if (to.path === '/user/login') {\n      // next({ path: '/dashboard/workplace' })\n      next()\n      NProgress.done()\n    } else {\n      if (store.getters.roles.length === 0) {\n        store\n          .dispatch('GetInfo')\n          .then(() => {\n            // 先获取主菜单\n            store.dispatch('GetTopMenu').then(() => {\n              let currentTopMenu = getSessionStorage(CURRENT_TOP_MENU)\n              if (!currentTopMenu) {\n                const topMenu = store.getters.topMenuList\n\n                currentTopMenu = (topMenu[0] && topMenu[0].id) || '1'\n                setSessionStorage(CURRENT_TOP_MENU, currentTopMenu)\n              }\n              // 调用 vuex 的 从后端获取用户的路由菜单，动态添加可访问路由表\n              store.dispatch('GenerateRoutes', { currentTopMenu: currentTopMenu }).then(() => {\n                // 把已获取到的路由菜单加入到路由表中\n                const route = store.getters.addRouters\n                let routeMap = []\n                for (const key in route) {\n                  routeMap = routeMap.concat(route[key])\n                }\n                routeMap.push(notFoundRouter)\n                router.addRoutes(routeMap)\n                const redirect = decodeURIComponent(from.query.redirect || to.path)\n                if (to.path === redirect) {\n                  // hack方法 确保addRoutes已完成 ,set the replace: true so the navigation will not leave a history record\n                  next({ ...to, replace: true })\n                } else {\n                  // 跳转到目的路由\n                  next({ path: redirect })\n                }\n              })\n            })\n          })\n          .catch(() => {\n            notification.error({\n              message: '错误',\n              description: '请求用户信息失败，请重试'\n            })\n            store.dispatch('Logout').then(() => {\n              next({ path: '/user/login', query: { redirect: to.fullPath } })\n            })\n          })\n      } else {\n        next()\n      }\n    }\n  } else {\n    if (whiteList.includes(to.name)) {\n      // 在免登录白名单，直接进入\n      next()\n    } else {\n      if (to.fullPath !== '/' && to.fullPath !== '') {\n        next({ path: '/user/login', query: { redirect: to.fullPath } })\n      } else {\n        next({ path: '/portalClient/index' })\n      }\n      NProgress.done() // if current page is login will not trigger afterEach hook, so manually handle it\n    }\n  }\n})\n\nrouter.afterEach(() => {\n  NProgress.done() // finish progress bar\n})\n"]}]}